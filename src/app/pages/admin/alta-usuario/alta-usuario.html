<div class="form-container">
  <form class="form-box" [formGroup]="form" (ngSubmit)="guardar()" novalidate>
    <button type="button" class="btn-back" (click)="volver()">← Volver a Usuarios</button>
    <h2>Nuevo usuario</h2>

    <div class="grid">
      <div class="form-field full">
        <label for="rol">Rol</label>
        <select id="rol" formControlName="rol" (change)="onRolChange($any($event.target).value)">
          <option value="paciente">Paciente</option>
          <option value="especialista">Especialista</option>
          <option value="admin">Administrador</option>
        </select>
      </div>

      <div class="form-field">
        <label>Nombre</label>
        <input type="text" formControlName="nombre" />
      </div>
      <div class="form-field">
        <label>Apellido</label>
        <input type="text" formControlName="apellido" />
      </div>

      <div class="form-field">
        <label>Email</label>
        <input type="email" formControlName="email" />
      </div>
      <div class="form-field">
        <label>Password</label>
        <input type="password" formControlName="password" />
      </div>

      <div class="form-field">
        <label>Edad</label>
        <input type="number" formControlName="edad" />
      </div>
      <div class="form-field">
        <label>DNI</label>
        <input type="text" formControlName="dni" />
      </div>

      <ng-container *ngIf="rol === 'paciente'">
        <div class="form-field full">
          <label>Obra Social</label>
          <input type="text" formControlName="obraSocial" />
        </div>
        <div class="form-field">
          <label>Imagen 1 (obligatoria)</label>
          <input
            type="file"
            class="input-file"
            accept="image/*"
            (change)="onFileChange('pac1', $event)"
          />
        </div>
        <div class="form-field">
          <label>Imagen 2 (obligatoria)</label>
          <input
            type="file"
            class="input-file"
            accept="image/*"
            (change)="onFileChange('pac2', $event)"
          />
        </div>
      </ng-container>

      <ng-container *ngIf="rol === 'especialista'">
        <div class="form-field full">
          <label>Agregar especialidad</label>
          <div class="row">
            <input type="text" #esp />
            <button
              type="button"
              class="btn-small"
              (click)="addEspecialidad(esp.value); esp.value = ''"
            >
              Agregar
            </button>
          </div>
          <div class="chips">
            <span class="chip" *ngFor="let c of especialidadesFA.controls; let i = index">
              {{ c.value }}
              <button type="button" class="chip-x" (click)="removeEspecialidad(i)">×</button>
            </span>
          </div>
        </div>
        <div class="form-field full">
          <label>Imagen de perfil (obligatoria)</label>
          <input
            type="file"
            class="input-file"
            accept="image/*"
            (change)="onFileChange('esp', $event)"
          />
        </div>
      </ng-container>

      <ng-container *ngIf="rol === 'admin'">
        <div class="form-field full">
          <label>Imagen de perfil (obligatoria)</label>
          <input
            type="file"
            class="input-file"
            accept="image/*"
            (change)="onFileChange('adm', $event)"
          />
        </div>
      </ng-container>
    </div>

    <div class="actions">
      <button type="submit" class="btn">Guardar</button>
    </div>
  </form>
</div>
